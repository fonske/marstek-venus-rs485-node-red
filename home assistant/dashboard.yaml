views:
  - type: sections
    path: home-battery-control
    max_columns: 3
    title: Home battery control
    icon: mdi:home-battery-outline
    sections:
      - type: grid
        cards:
          - type: heading
            heading: Master Battery Control
            heading_style: title
          - features:
              - type: select-options
            type: tile
            entity: input_select.marstek_master_battery_mode
            features_position: bottom
            vertical: false
            show_entity_picture: false
            hide_state: true
            name: Control Mode
            icon: mdi:camera-control
          - features:
              - type: select-options
            type: tile
            entity: input_select.house_battery_strategy
            features_position: bottom
            vertical: false
            hide_state: true
            show_entity_picture: false
            name: Full Control Strategy
          - type: history-graph
            entities:
              - entity: input_number.house_battery_control_pid_output
              - entity: select.marstek_m1_forcible_charge_discharge
                name: M1
              - entity: select.marstek_m2_forcible_charge_discharge
                name: M2
              - entity: select.marstek_m3_forcible_charge_discharge
                name: M3
            hours_to_show: 0.05
          - type: entities
            entities:
              - entity: input_number.house_battery_control_kp
                name: Proportional gain (Kp)
              - entity: input_number.house_battery_control_ki
                name: Integral gain (Ki)
              - entity: input_number.house_battery_control_kd
                name: Differential gain (Kd)
              - entity: input_number.house_battery_control_error_signal_dampening
                name: Input smoothing
                secondary_info: none
              - entity: input_number.house_battery_control_pid_output_dampening
                name: Output smoothing
            title: PID controls
          - type: entities
            entities:
              - entity: input_number.house_battery_control_idle_time
                name: Stop after Idle for
              - entity: input_number.house_battery_control_hysteresis_in_w
                name: 'Hysteresis '
                secondary_info: none
              - entity: input_number.house_target_grid_consumption_in_w
          - type: entities
            title: Marstek grid charge or wait strategy
            show_header_toggle: false
            entities:
              - entity: input_datetime.strategy_accu_grid_charge_or_wait_start_at
                name: Start grid charging / wait at
              - entity: input_datetime.strategy_accu_grid_charge_or_wait_stop_at
                name: Stop grid charging / wait at
              - entity: input_boolean.strategy_accu_grid_charge_or_wait_charge_enabled
                name: Charge during strategy
              - entity: input_number.strategy_accu_grid_charge_or_wait_total_target_capacity
                name: Grid charging target capacity
              - entity: input_select.strategy_accu_grid_charge_or_wait_switch_to_strategy_when_finished
                name: Switch to strategy when finished

      - cards:
          - type: heading
            heading: Histrory
          - title: PID analysis
            type: history-graph
            entities:
              - entity: input_number.house_battery_control_error_signal
              - entity: sensor.p1_meter_vermogen
              - entity: input_number.house_battery_control_pid_output
              - entity: input_number.house_battery_control_p_term
              - entity: input_number.house_battery_control_i_term
              - entity: input_number.house_battery_control_d_term
            grid_options:
              columns: full
            hours_to_show: 0.1
        column_span: 3
    header:
      card:
        type: markdown
        content: |-
          # Home batteries
          Status en settings
        text_only: true
