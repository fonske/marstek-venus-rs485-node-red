- sensor:
    # This file contains template sensors for Home Assistant.
    # It is included in the main configuration.yaml file.

    # Example: sensor for single-phase power meter
    - name: "L1 Meter Power"
      unique_id: "l1_meter_power"
      unit_of_measurement: "W"
      device_class: "power"
      state_class: "measurement"
      state: >
        {% set consumption = states('sensor.electricity_meter_power_consumption_phase_l1') | float(0) %}
        {% set production = states('sensor.electricity_meter_power_production_phase_l1') | float(0) %}
        {{ (consumption - production) | round(2) }}

    # House battery control | Grid power
    # Your P1 meter indicates the power drawn or returned to grid.
    # This "P1 meter power" sensor acts as an alias for you power sensing configuration and is used throughout the node-RED scripts.
    - name: "Grid Power"
      unique_id: "p1_meter_power"
      state: "{{ states('sensor.l1_meter_power') }}" # << SET YOUR GRID POWER SENSOR HERE
      unit_of_measurement: "W"
      device_class: "power"
      state_class: "measurement"
